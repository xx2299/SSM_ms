% Read the data
tp1504=ncread('15_4.nc','tp');
tp1504=single(tp1504);
tp1505=ncread('15_5.nc','tp');
tp1505=single(tp1505);
tp1506=ncread('15_6.nc','tp');
tp1506=single(tp1506);
A1504=read_ERA5(tp1504);
A1505=read_ERA5(tp1505);
A1506=read_ERA5(tp1506);
tp1507=ncread('15_7.nc','tp');
tp1507=single(tp1507);
tp1508=ncread('15_8.nc','tp');
tp1508=single(tp1508);
tp1509=ncread('15_9.nc','tp');
tp1509=single(tp1509);
A1507=read_ERA5(tp1507);
A1508=read_ERA5(tp1508);
A1509=read_ERA5(tp1509);
tp1510=ncread('15_10.nc','tp');
tp1510=single(tp1510);
tp1511=ncread('15_11.nc','tp');
tp1511=single(tp1511);
tp1512=ncread('15_12.nc','tp');
tp1512=single(tp1512);
A1510=read_ERA5(tp1510);
A1511=read_ERA5(tp1511);
A1512=read_ERA5(tp1512);
tp1601=ncread('16_1.nc','tp');
tp1601=single(tp1601);
tp1602=ncread('16_2.nc','tp');
tp1602=single(tp1602);
tp1603=ncread('16_3.nc','tp');
tp1603=single(tp1603);
A1601=read_ERA5(tp1601);
A1602=read_ERA5(tp1602);
A1603=read_ERA5(tp1603);
tp1604=ncread('16_4.nc','tp');
tp1604=single(tp1604);
tp1605=ncread('16_5.nc','tp');
tp1605=single(tp1605);
tp1606=ncread('16_6.nc','tp');
tp1606=single(tp1606);
A1604=read_ERA5(tp1604);
A1605=read_ERA5(tp1605);
A1606=read_ERA5(tp1606);
tp1607=ncread('16_7.nc','tp');
tp1607=single(tp1607);
tp1608=ncread('16_8.nc','tp');
tp1608=single(tp1608);
tp1609=ncread('16_9.nc','tp');
tp1609=single(tp1609);
A1607=read_ERA5(tp1607);
A1608=read_ERA5(tp1608);
A1609=read_ERA5(tp1609);
tp1610=ncread('16_10.nc','tp');
tp1610=single(tp1610);
tp1611=ncread('16_11.nc','tp');
tp1611=single(tp1611);
tp1612=ncread('16_12.nc','tp');
tp1612=single(tp1612);
A1610=read_ERA5(tp1610);
A1611=read_ERA5(tp1611);
A1612=read_ERA5(tp1612);
tp1701=ncread('17_1.nc','tp');
tp1701=single(tp1701);
tp1702=ncread('17_2.nc','tp');
tp1702=single(tp1702);
tp1703=ncread('17_3.nc','tp');
tp1703=single(tp1703);
A1701=read_ERA5(tp1701);
A1702=read_ERA5(tp1702);
A1703=read_ERA5(tp1703);
tp1704=ncread('17_4.nc','tp');
tp1704=single(tp1704);
tp1705=ncread('17_5.nc','tp');
tp1705=single(tp1705);
tp1706=ncread('17_6.nc','tp');
tp1706=single(tp1706);
A1704=read_ERA5(tp1704);
A1705=read_ERA5(tp1705);
A1706=read_ERA5(tp1706);
tp1707=ncread('17_7.nc','tp');
tp1707=single(tp1707);
tp1708=ncread('17_8.nc','tp');
tp1708=single(tp1708);
tp1709=ncread('17_9.nc','tp');
tp1709=single(tp1709);
A1707=read_ERA5(tp1707);
A1708=read_ERA5(tp1708);
A1709=read_ERA5(tp1709);
tp1710=ncread('17_10.nc','tp');
tp1710=single(tp1710);
tp1711=ncread('17_11.nc','tp');
tp1711=single(tp1711);
tp1712=ncread('17_12.nc','tp');
tp1712=single(tp1712);
A1710=read_ERA5(tp1710);
A1711=read_ERA5(tp1711);
A1712=read_ERA5(tp1712);
tp1801=ncread('18_1.nc','tp');
tp1801=single(tp1801);
tp1802=ncread('18_2.nc','tp');
tp1802=single(tp1802);
tp1803=ncread('18_3.nc','tp');
tp1803=single(tp1803);
A1801=read_ERA5(tp1801);
A1802=read_ERA5(tp1802);
A1803=read_ERA5(tp1803);
tp1804=ncread('18_4.nc','tp');
tp1804=single(tp1804);
tp1805=ncread('18_5.nc','tp');
tp1805=single(tp1805);
tp1806=ncread('18_6.nc','tp');
tp1806=single(tp1806);
A1804=read_ERA5(tp1804);
A1805=read_ERA5(tp1805);
A1806=read_ERA5(tp1806);
tp1807=ncread('18_7.nc','tp');
tp1807=single(tp1807);
tp1808=ncread('18_8.nc','tp');
tp1808=single(tp1808);
tp1809=ncread('18_9.nc','tp');
tp1809=single(tp1809);
A1807=read_ERA5(tp1807);
A1808=read_ERA5(tp1808);
A1809=read_ERA5(tp1809);
tp1810=ncread('18_10.nc','tp');
tp1810=single(tp1810);
tp1811=ncread('18_11.nc','tp');
tp1811=single(tp1811);
tp1812=ncread('18_12.nc','tp');
tp1812=single(tp1812);
A1810=read_ERA5(tp1810);
A1811=read_ERA5(tp1811);
A1812=read_ERA5(tp1812);
tp1901=ncread('19_1.nc','tp');
tp1901=single(tp1901);
tp1902=ncread('19_2.nc','tp');
tp1902=single(tp1902);
tp1903=ncread('19_3.nc','tp');
tp1903=single(tp1903);
A1901=read_ERA5(tp1901);
A1902=read_ERA5(tp1902);
A1903=read_ERA5(tp1903);
tp1904=ncread('19_4.nc','tp');
tp1904=single(tp1904);
tp1905=ncread('19_5.nc','tp');
tp1905=single(tp1905);
tp1906=ncread('19_6.nc','tp');
tp1906=single(tp1906);
A1904=read_ERA5(tp1904);
A1905=read_ERA5(tp1905);
A1906=read_ERA5(tp1906);
tp1907=ncread('19_7.nc','tp');
tp1907=single(tp1907);
tp1908=ncread('19_8.nc','tp');
tp1908=single(tp1908);
tp1909=ncread('19_9.nc','tp');
tp1909=single(tp1909);
A1907=read_ERA5(tp1907);
A1908=read_ERA5(tp1908);
A1909=read_ERA5(tp1909);
tp1910=ncread('19_10.nc','tp');
tp1910=single(tp1910);
tp1911=ncread('19_11.nc','tp');
tp1911=single(tp1911);
tp1912=ncread('19_12.nc','tp');
tp1912=single(tp1912);
A1910=read_ERA5(tp1910);
A1911=read_ERA5(tp1911);
A1912=read_ERA5(tp1912);
tp2001=ncread('20_1.nc','tp');
tp2001=single(tp2001);
tp2002=ncread('20_2.nc','tp');
tp2002=single(tp2002);
tp2003=ncread('20_3.nc','tp');
tp2003=single(tp2003);
A2001=read_ERA5(tp2001);
A2002=read_ERA5(tp2002);
A2003=read_ERA5(tp2003);
tp2004=ncread('20_4.nc','tp');
tp2004=single(tp2004);
tp2005=ncread('20_5.nc','tp');
tp2005=single(tp2005);
tp2006=ncread('20_6.nc','tp');
tp2006=single(tp2006);
A2004=read_ERA5(tp2004);
A2005=read_ERA5(tp2005);
A2006=read_ERA5(tp2006);
tp2007=ncread('20_7.nc','tp');
tp2007=single(tp2007);
tp2008=ncread('20_8.nc','tp');
tp2008=single(tp2008);
tp2009=ncread('20_9.nc','tp');
tp2009=single(tp2009);
A2007=read_ERA5(tp2007);
A2008=read_ERA5(tp2008);
A2009=read_ERA5(tp2009);
tp2010=ncread('20_10.nc','tp');
tp2010=single(tp2010);
tp2011=ncread('20_11.nc','tp');
tp2011=single(tp2011);
tp2012=ncread('20_12.nc','tp');
tp2012=single(tp2012);
A2010=read_ERA5(tp2010);
A2011=read_ERA5(tp2011);
A2012=read_ERA5(tp2012);
% Evenly split monthly A to 32 chunks
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\monthly_A\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
split_num=32;
temp_num=1440*721/split_num;
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    for i=1:split_num
        eval(['A',num2str(m),'_',num2str(i),'=','A_temp(:,temp_num*(i-1)+1:temp_num*i)',';']);
        fileDir='E:\Obv_2021\ERA5\Pr\data\8_per_day\split_A\';
        filename=strcat(fileDir,'A',num2str(m),'_',num2str(i),'.mat');
        save(filename,['A',num2str(m),'_',num2str(i)])
        eval(['clear ','A',num2str(m),'_',num2str(i),';'])
        disp(i)
    end
    disp(m)
end
% Calculate Pr_n and Pr_kw for EAR5 data
N=16816;
Fs=8;
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_1\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_1=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_1=[A_1;A_temp];
    disp(m)
end
[ybar1_1,ybar2_1,ybar3_1]=FFT_PA(A_1,N,Fs);
[PrP1_1,PrP2_1,PrP3_1]=ERA5_P(A_1,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_2\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_2=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_2=[A_2;A_temp];
    disp(m)
end
[ybar1_2,ybar2_2,ybar3_2]=FFT_PA(A_2,N,Fs);
[PrP1_2,PrP2_2,PrP3_2]=ERA5_P(A_2,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_3\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_3=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_3=[A_3;A_temp];
    disp(m)
end
[ybar1_3,ybar2_3,ybar3_3]=FFT_PA(A_3,N,Fs);
[PrP1_3,PrP2_3,PrP3_3]=ERA5_P(A_3,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_4\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_4=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_4=[A_4;A_temp];
    disp(m)
end
[ybar1_4,ybar2_4,ybar3_4]=FFT_PA(A_4,N,Fs);
[PrP1_4,PrP2_4,PrP3_4]=ERA5_P(A_4,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_5\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_5=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_5=[A_5;A_temp];
    disp(m)
end
[ybar1_5,ybar2_5,ybar3_5]=FFT_PA(A_5,N,Fs);
[PrP1_5,PrP2_5,PrP3_5]=ERA5_P(A_5,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_6\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_6=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_6=[A_6;A_temp];
    disp(m)
end
[ybar1_6,ybar2_6,ybar3_6]=FFT_PA(A_6,N,Fs);
[PrP1_6,PrP2_6,PrP3_6]=ERA5_P(A_6,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_7\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_7=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_7=[A_7;A_temp];
    disp(m)
end
[ybar1_7,ybar2_7,ybar3_7]=FFT_PA(A_7,N,Fs);
[PrP1_7,PrP2_7,PrP3_7]=ERA5_P(A_7,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_8\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_8=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_8=[A_8;A_temp];
    disp(m)
end
[ybar1_8,ybar2_8,ybar3_8]=FFT_PA(A_8,N,Fs);
[PrP1_8,PrP2_8,PrP3_8]=ERA5_P(A_8,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_9\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_9=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_9=[A_9;A_temp];
    disp(m)
end
[ybar1_9,ybar2_9,ybar3_9]=FFT_PA(A_9,N,Fs);
[PrP1_9,PrP2_9,PrP3_9]=ERA5_P(A_9,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_10\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_10=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_10=[A_10;A_temp];
    disp(m)
end
[ybar1_10,ybar2_10,ybar3_10]=FFT_PA(A_10,N,Fs);
[PrP1_10,PrP2_10,PrP3_10]=ERA5_P(A_10,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_11\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_11=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_11=[A_11;A_temp];
    disp(m)
end
[ybar1_11,ybar2_11,ybar3_11]=FFT_PA(A_11,N,Fs);
[PrP1_11,PrP2_11,PrP3_11]=ERA5_P(A_11,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_12\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_12=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_12=[A_12;A_temp];
    disp(m)
end
[ybar1_12,ybar2_12,ybar3_12]=FFT_PA(A_12,N,Fs);
[PrP1_12,PrP2_12,PrP3_12]=ERA5_P(A_12,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_13\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_13=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_13=[A_13;A_temp];
    disp(m)
end
[ybar1_13,ybar2_13,ybar3_13]=FFT_PA(A_13,N,Fs);
[PrP1_13,PrP2_13,PrP3_13]=ERA5_P(A_13,N,Fs);
clear A_13
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_14\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_14=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_14=[A_14;A_temp];
    disp(m)
end
[ybar1_14,ybar2_14,ybar3_14]=FFT_PA(A_14,N,Fs);
[PrP1_14,PrP2_14,PrP3_14]=ERA5_P(A_14,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_15\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_15=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_15=[A_15;A_temp];
    disp(m)
end
[ybar1_15,ybar2_15,ybar3_15]=FFT_PA(A_15,N,Fs);
[PrP1_15,PrP2_15,PrP3_15]=ERA5_P(A_15,N,Fs);
clear A_15
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_16\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_16=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_16=[A_16;A_temp];
    disp(m)
end
[ybar1_16,ybar2_16,ybar3_16]=FFT_PA(A_16,N,Fs);
[PrP1_16,PrP2_16,PrP3_16]=ERA5_P(A_16,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_17\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_17=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_17=[A_17;A_temp];
    disp(m)
end
[ybar1_17,ybar2_17,ybar3_17]=FFT_PA(A_17,N,Fs);
[PrP1_17,PrP2_17,PrP3_17]=ERA5_P(A_17,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_18\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_18=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_18=[A_18;A_temp];
    disp(m)
end
[ybar1_18,ybar2_18,ybar3_18]=FFT_PA(A_18,N,Fs);
[PrP1_18,PrP2_18,PrP3_18]=ERA5_P(A_18,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_19\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_19=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_19=[A_19;A_temp];
    disp(m)
end
[ybar1_19,ybar2_19,ybar3_19]=FFT_PA(A_19,N,Fs);
[PrP1_19,PrP2_19,PrP3_19]=ERA5_P(A_19,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_20\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_20=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_20=[A_20;A_temp];
    disp(m)
end
[ybar1_20,ybar2_20,ybar3_20]=FFT_PA(A_20,N,Fs);
[PrP1_20,PrP2_20,PrP3_20]=ERA5_P(A_20,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_21\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_21=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_21=[A_21;A_temp];
    disp(m)
end
[ybar1_21,ybar2_21,ybar3_21]=FFT_PA(A_21,N,Fs);
[PrP1_21,PrP2_21,PrP3_21]=ERA5_P(A_21,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_22\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_22=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_22=[A_22;A_temp];
    disp(m)
end
[ybar1_22,ybar2_22,ybar3_22]=FFT_PA(A_22,N,Fs);
[PrP1_22,PrP2_22,PrP3_22]=ERA5_P(A_22,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_23\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_23=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_23=[A_23;A_temp];
    disp(m)
end
[ybar1_23,ybar2_23,ybar3_23]=FFT_PA(A_23,N,Fs);
[PrP1_23,PrP2_23,PrP3_23]=ERA5_P(A_23,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_24\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_24=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_24=[A_24;A_temp];
    disp(m)
end
[ybar1_24,ybar2_24,ybar3_24]=FFT_PA(A_24,N,Fs);
[PrP1_24,PrP2_24,PrP3_24]=ERA5_P(A_24,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_25\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_25=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_25=[A_25;A_temp];
    disp(m)
end
[ybar1_25,ybar2_25,ybar3_25]=FFT_PA(A_25,N,Fs);
[PrP1_25,PrP2_25,PrP3_25]=ERA5_P(A_25,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_26\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_26=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_26=[A_26;A_temp];
    disp(m)
end
[ybar1_26,ybar2_26,ybar3_26]=FFT_PA(A_26,N,Fs);
[PrP1_26,PrP2_26,PrP3_26]=ERA5_P(A_26,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_27\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_27=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_27=[A_27;A_temp];
    disp(m)
end
[ybar1_27,ybar2_27,ybar3_27]=FFT_PA(A_27,N,Fs);
[PrP1_27,PrP2_27,PrP3_27]=ERA5_P(A_27,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_28\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_28=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_28=[A_28;A_temp];
    disp(m)
end
[ybar1_28,ybar2_28,ybar3_28]=FFT_PA(A_28,N,Fs);
[PrP1_28,PrP2_28,PrP3_28]=ERA5_P(A_28,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_29\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_29=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_29=[A_29;A_temp];
    disp(m)
end
[ybar1_29,ybar2_29,ybar3_29]=FFT_PA(A_29,N,Fs);
[PrP1_29,PrP2_29,PrP3_29]=ERA5_P(A_29,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_30\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_30=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_30=[A_30;A_temp];
    disp(m)
end
[ybar1_30,ybar2_30,ybar3_30]=FFT_PA(A_30,N,Fs);
[PrP1_30,PrP2_30,PrP3_30]=ERA5_P(A_30,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_31\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_31=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_31=[A_31;A_temp];
    disp(m)
end
[ybar1_31,ybar2_31,ybar3_31]=FFT_PA(A_31,N,Fs);
[PrP1_31,PrP2_31,PrP3_31]=ERA5_P(A_31,N,Fs);
datadir='E:\Obv_2021\ERA5\Pr\data\8_per_day\splice_A\A_32\';
filelist=dir([datadir,'*.mat']);
k=length(filelist);
A_32=[];
for m=1:k
    A_temp=cell2mat(struct2cell(load(strcat(datadir,filelist(m).name))));
    A_32=[A_32;A_temp];
    disp(m)
end
[ybar1_32,ybar2_32,ybar3_32]=FFT_PA(A_32,N,Fs);
[PrP1_32,PrP2_32,PrP3_32]=ERA5_P(A_32,N,Fs);

% % Calculate ERA5 Pr_n
Pr_ybar1=[ybar1_1,ybar1_2,ybar1_3,ybar1_4,ybar1_5,ybar1_6,ybar1_7,ybar1_8,ybar1_9,ybar1_10,ybar1_11,ybar1_12,ybar1_13,ybar1_14,ybar1_15,ybar1_16,ybar1_17,ybar1_18,ybar1_19,ybar1_20,ybar1_21,ybar1_22,ybar1_23,ybar1_24,ybar1_25,ybar1_26,ybar1_27,ybar1_28,ybar1_29,ybar1_30,ybar1_31,ybar1_32];
Pr_ybar2=[ybar2_1,ybar2_2,ybar2_3,ybar2_4,ybar2_5,ybar2_6,ybar2_7,ybar2_8,ybar2_9,ybar2_10,ybar2_11,ybar2_12,ybar2_13,ybar2_14,ybar2_15,ybar2_16,ybar2_17,ybar2_18,ybar2_19,ybar2_20,ybar2_21,ybar2_22,ybar2_23,ybar2_24,ybar2_25,ybar2_26,ybar2_27,ybar2_28,ybar2_29,ybar2_30,ybar2_31,ybar2_32];
Pr_ybar3=[ybar3_1,ybar3_2,ybar3_3,ybar3_4,ybar3_5,ybar3_6,ybar3_7,ybar3_8,ybar3_9,ybar3_10,ybar3_11,ybar3_12,ybar3_13,ybar3_14,ybar3_15,ybar3_16,ybar3_17,ybar3_18,ybar3_19,ybar3_20,ybar3_21,ybar3_22,ybar3_23,ybar3_24,ybar3_25,ybar3_26,ybar3_27,ybar3_28,ybar3_29,ybar3_30,ybar3_31,ybar3_32];
% Calculate original ERA5 Pr_n
Pr_F1=D_rotation(Pr_ybar1);
Pr_F2=D_rotation(Pr_ybar2);
Pr_F3=D_rotation(Pr_ybar3);
ERA5_F1=Pr_F1./(Pr_F1+Pr_F2+Pr_F3);
ERA5_F2=Pr_F2./(Pr_F1+Pr_F2+Pr_F3);
ERA5_F3=Pr_F3./(Pr_F1+Pr_F2+Pr_F3);
% Change the spatial resolution of the ERA5's Pr_n to the same as SMAP
ERA5_F1_t=ERA5_F1.';
ERA5_f1=reshape(ERA5_F1_t,[1038240,1]);
ERA5_F2_t=ERA5_F2.';
ERA5_f2=reshape(ERA5_F2_t,[1038240,1]);
ERA5_F3_t=ERA5_F3.';
ERA5_f3=reshape(ERA5_F3_t,[1038240,1]);
lon=linspace(-179.95,179.95,1440);
lonERA5=lon.';
ERA5_new_f1=ERA5_SMAP_resolution(SMAP1,ERA5_f1,latERA5,lonERA5);
ERA5_new_f2=ERA5_SMAP_resolution(SMAP2,ERA5_f2,latERA5,lonERA5);
ERA5_new_f3=ERA5_SMAP_resolution(SMAP3,ERA5_f3,latERA5,lonERA5);
% Change ERA5's Pr_n has same surface coverage as SMAP
PrF1_new=knn_mean(SMF_template,ERA5_new_f1,1);
PrF2_new=knn_mean(SMF_template,ERA5_new_f2,1);
PrF3_new=knn_mean(SMF_template,ERA5_new_f3,1);

% % Calculate ERA5 Pr_kw
PrP1=[PrP1_1,PrP1_2,PrP1_3,PrP1_4,PrP1_5,PrP1_6,PrP1_7,PrP1_8,PrP1_9,PrP1_10,PrP1_11,PrP1_12,PrP1_13,PrP1_14,PrP1_15,PrP1_16,PrP1_17,PrP1_18,PrP1_19,PrP1_20,PrP1_21,PrP1_22,PrP1_23,PrP1_24,PrP1_25,PrP1_26,PrP1_27,PrP1_28,PrP1_29,PrP1_30,PrP1_31,PrP1_32];
PrP2=[PrP2_1,PrP2_2,PrP2_3,PrP2_4,PrP2_5,PrP2_6,PrP2_7,PrP2_8,PrP2_9,PrP2_10,PrP2_11,PrP2_12,PrP2_13,PrP2_14,PrP2_15,PrP2_16,PrP2_17,PrP2_18,PrP2_19,PrP2_20,PrP2_21,PrP2_22,PrP2_23,PrP2_24,PrP2_25,PrP2_26,PrP2_27,PrP2_28,PrP2_29,PrP2_30,PrP2_31,PrP2_32];
PrP3=[PrP3_1,PrP3_2,PrP3_3,PrP3_4,PrP3_5,PrP3_6,PrP3_7,PrP3_8,PrP3_9,PrP3_10,PrP3_11,PrP3_12,PrP3_13,PrP3_14,PrP3_15,PrP3_16,PrP3_17,PrP3_18,PrP3_19,PrP3_20,PrP3_21,PrP3_22,PrP3_23,PrP3_24,PrP3_25,PrP3_26,PrP3_27,PrP3_28,PrP3_29,PrP3_30,PrP3_31,PrP3_32];
% Calculate original ERA5 Pr_kw
ERA5_P1=D_rotation(PrP1);
ERA5_P2=D_rotation(PrP2);
ERA5_P3=D_rotation(PrP3);
% Change the spatial resolution of the ERA5's Pr_kw to the same as SMAP
ERA5_P1_t=ERA5_P1.';
ERA5_p1=reshape(ERA5_P1_t,[1038240,1]);
ERA5_P2_t=ERA5_P2.';
ERA5_p2=reshape(ERA5_P2_t,[1038240,1]);
ERA5_P3_t=ERA5_P3.';
ERA5_p3=reshape(ERA5_P3_t,[1038240,1]);
lon=linspace(-179.95,179.95,1440);
lonERA5=lon.';
ERA5_new_p1=ERA5_SMAP_resolution(SMAP1,ERA5_p1,latERA5,lonERA5);
ERA5_new_p2=ERA5_SMAP_resolution(SMAP2,ERA5_p2,latERA5,lonERA5);
ERA5_new_p3=ERA5_SMAP_resolution(SMAP3,ERA5_p3,latERA5,lonERA5);
% Change ERA5's Pr_kw has same surface coverage as SMAP
PrP1_new=knn_mean(SMF_template,ERA5_new_p1,1);
PrP2_new=knn_mean(SMF_template,ERA5_new_p2,1);
PrP3_new=knn_mean(SMF_template,ERA5_new_p3,1);

% % Functions
function A=read_ERA5(Data)
[~,~,t]=size(Data);
A(t,1038240)=0;
count=1;
for q=1:721
    for p=1:1440
        C=Data(p,q,:);
        A(:,count)=C(:);
        count=count+1;
    end
    disp(q)
end
A=single(A);
end

function [ybar1,ybar2,ybar3]=FFT_PA(data,N,Fs)
Y=fft(data);
clear data
Ayy=abs(Y).^2;
clear Y
Ayy=Ayy(1:8408,:);
Ayy=Ayy/(N/2);
F=((1:N)-1)*Fs/N;
x=F(1:N/2);
a=find(abs(x-1/7)<=0.0002);
b=find(abs(x-1/30)<=0.0002);
c=find(abs(x-1/90)<=0.0002);
d=find(abs(x-1/365)<=0.0002);
ybar1=nansum(Ayy(b:a,:));
ybar2=nansum(Ayy(c:b,:));
ybar3=nansum(Ayy(d:c,:));
end

function ERA5_F=D_rotation(ybar)
tp_1=reshape(ybar,[1440 721]);
tp_2=flipud(tp_1);
tp_F=rot90(tp_2,-1);
a1=tp_F(:,1:720);
a2=tp_F(:,721:1440);
ERA5_F=[a2,a1];
end

function [Prp1,Prp2,Prp3]=ERA5_P(ERA5_A,N,Fs)
F=((1:N)-1)*Fs/N;
x=F(1:N/2);
a=find(abs(x-1/7)<=0.0002);
b=find(abs(x-1/30)<=0.0002);
c=find(abs(x-1/90)<=0.0002);
d=find(abs(x-1/365)<=0.0002);
[~,n]=size(ERA5_A);
Prp1(1,n)=0;
Prp2(1,n)=0;
Prp3(1,n)=0;
count=1;
for i=1:n
    temp=isnan(ERA5_A(:,i));
    if sum(temp)>=16815
        Prp1(1,count)=nan;
        Prp2(1,count)=nan;
        Prp3(1,count)=nan;
    else
        A=ERA5_A(:,i);
        var=sum((A-mean(A)).^2)/length(A);
        Y=fft(A);
        Y=Y(1:(N/2),:);
        Ayy=abs(Y).^2;
        Ayy=Ayy/(N/2)/var;
        X=[ones(length(Ayy),1),x'];
        p1=polyfit(log(X(b:a,2)),log(Ayy(b:a)),1);
        Prp1(1,count)=p1(1);
        p2=polyfit(log(X(c:b,2)),log(Ayy(c:b)),1);
        Prp2(1,count)=p2(1);
        p3=polyfit(log(X(d:c,2)),log(Ayy(d:c)),1);
        Prp3(1,count)=p3(1);
    end
    disp(i);
    count=count+1;
end
end

function [ERA5_F]=ERA5_SMAP_resolution(SMAP_f,ERA5_f,latData,lonData)
count=1;
for i=1:721
    ERA5_lat(count:count+1439,1)=latData(i,1);
    ERA5_lon(count:count+1439,1)=lonData;
    count=count+1440;
end
ERA5_lat=single(ERA5_lat);
ERA5_lon=single(ERA5_lon);
ERA5=[ERA5_lat,ERA5_lon,ERA5_f];
[m1,~]=size(ERA5);
[m2,~]=size(SMAP_f);
dif(m1,1)=0;
ERA5_new_f(m2,1)=0;
for j=1:m2
    count=1;
    for i=1:m1
        dif(count,1)=abs(ERA5(i,1)-SMAP_f(j,1))+abs(ERA5(i,2)-SMAP_f(j,2));
        count=count+1;
    end
    [~,idx]=min(dif);
    ERA5_new_f(j,1)=ERA5(idx,3);
    disp(j)
end
new_f=reshape(ERA5_new_f,[964,406]);
ERA5_F=new_f.';
end

function [n_mF]=knn_mean(obv_F,n_mF,p_num)
% % logistic difference between model and SMAP (0:same, 1:pixel non-NaN for model but NaN for SMAP(1-0=1), -1:pixel NaN for model but non-NaN for SMAP (0-1=-1))
logic_temp_obv=single(~isnan(obv_F));
logic_temp_modelf=single(~isnan(n_mF));
diff_temp=logic_temp_modelf-logic_temp_obv;
n_mF(diff_temp==1)=nan;   % change non-NaN for model but NaN for SMAP to NaN in model
diff_num=length(find(diff_temp==-1));
while diff_num>0
    % % change NaN for model but non-NaN for SMAP to non-NaN in model (KNN-mean)
    dim=size(obv_F);
    [lat,lon]=find(diff_temp==-1);
    idx=find(diff_temp==-1);
    idx_temp=[lat,lon,idx];
    % % find corresponding index for pixels as non-NaN in SMAP
    p_c_lt=find(lon==1 & lat==1);   % left-top-corner pixel
    p_c_lb=find(lon==1 & lat==dim(1));   % left-bottom-corner pixel
    p_c_rt=find(lon==dim(2) & lat==1);   % right-top-corner pixel
    p_c_rb=find(lon==dim(2) & lat==dim(1));   % right-bottom-corner pixel
    p_t=find((lat==1 & lon~=1 & lon~=dim(2)));   % top line pixels (without corner)
    p_b=find((lat==dim(1) & lon~=1 & lon~=dim(2)));   % bottom line pixels (without corner)
    p_l=find((lon==1 & lat~=1 & lat~=dim(1)));   % left line pixels (without corner)
    p_r=find((lon==dim(2) & lat~=1 & lat~=dim(1)));   % right line pixels (without corner)
    p_o=find((lat~=1 & lat~=dim(1) & lon~=1 & lon~=dim(2)));   % other pixels
    % % change pixels with NaN for model but non-NaN for SMAP to non-NaN in model (four corners)
    n_mF(idx(p_c_lt))=nanmean([n_mF(lat(p_c_lt),lon(p_c_lt)+p_num),n_mF(lat(p_c_lt)+p_num,lon(p_c_lt)),n_mF(lat(p_c_lt)+p_num,lon(p_c_lt)+1)]);
    n_mF(idx(p_c_lb))=nanmean([n_mF(lat(p_c_lb)-p_num,lon(p_c_lb)),n_mF(lat(p_c_lb),lon(p_c_lb)+p_num),n_mF(lat(p_c_lb)-p_num,lon(p_c_lb)+1)]);
    n_mF(idx(p_c_rt))=nanmean([n_mF(lat(p_c_rt),lon(p_c_rt)-p_num),n_mF(lat(p_c_rt)+p_num,lon(p_c_rt)),n_mF(lat(p_c_rt)+p_num,lon(p_c_rt)-1)]);
    n_mF(idx(p_c_rb))=nanmean([n_mF(lat(p_c_rb)-p_num,lon(p_c_rb)),n_mF(lat(p_c_rb),lon(p_c_rb)-p_num),n_mF(lat(p_c_rb)-p_num,lon(p_c_rb)-1)]);
    % % change pixels with NaN for model but non-NaN for SMAP to non-NaN in model (Outermost circle)
    % % n_t, n_b, n_l, n_r: number of pixels in top, bottom, left, right line
    for n_t=1:length(p_t)
        if lon(p_t(n_t))-p_num>=1 && lat(p_t(n_t))+p_num<=dim(1) && lon(p_t(n_t))+p_num<=dim(2)
            n_mF(idx(p_t(n_t)))=nanmean([n_mF(lat(p_t(n_t)),lon(p_t(n_t))-p_num),n_mF(lat(p_t(n_t))+p_num,lon(p_t(n_t))),n_mF(lat(p_t(n_t)),lon(p_t(n_t))+p_num),n_mF(lat(p_t(n_t))+p_num,lon(p_t(n_t))-p_num),n_mF(lat(p_t(n_t))+p_num,lon(p_t(n_t))+p_num)]);
        elseif lon(p_t(n_t))-p_num<1
            n_mF(idx(p_t(n_t)))=nanmean([n_mF(lat(p_t(n_t))+p_num,lon(p_t(n_t))),n_mF(lat(p_t(n_t)),lon(p_t(n_t))+p_num),n_mF(lat(p_t(n_t))+p_num,lon(p_t(n_t))+p_num)]);
        elseif lat(p_t(n_t))+p_num>dim(1)
            n_mF(idx(p_t(n_t)))=nanmean([n_mF(lat(p_t(n_t)),lon(p_t(n_t))-p_num),n_mF(lat(p_t(n_t)),lon(p_t(n_t))+p_num)]);
        elseif lon(p_t(n_t))+p_num>dim(2)
            n_mF(idx(p_t(n_t)))=nanmean([n_mF(lat(p_t(n_t)),lon(p_t(n_t))-p_num),n_mF(lat(p_t(n_t))+p_num,lon(p_t(n_t))),n_mF(lat(p_t(n_t))+p_num,lon(p_t(n_t))-p_num)]);
        end
    end
    for n_b=1:length(p_b)
        if lat(p_b(n_b))-p_num>=1 && lon(p_b(n_b))-p_num>=1 && lon(p_b(n_b))+p_num<=dim(2)
            n_mF(idx(p_b(n_b)))=nanmean([n_mF(lat(p_b(n_b)),lon(p_b(n_b))-p_num),n_mF(lat(p_b(n_b))-p_num,lon(p_b(n_b))),n_mF(lat(p_b(n_b)),lon(p_b(n_b))+p_num),n_mF(lat(p_b(n_b))-p_num,lon(p_b(n_b))-p_num),n_mF(lat(p_b(n_b))-p_num,lon(p_b(n_b))+p_num)]);
        elseif lat(p_b(n_b))-p_num<1
            n_mF(idx(p_b(n_b)))=nanmean([n_mF(lat(p_b(n_b)),lon(p_b(n_b))-p_num),n_mF(lat(p_b(n_b)),lon(p_b(n_b))+p_num)]);
        elseif lon(p_b(n_b))-p_num<1
            n_mF(idx(p_b(n_b)))=nanmean([n_mF(lat(p_b(n_b))-p_num,lon(p_b(n_b))),n_mF(lat(p_b(n_b)),lon(p_b(n_b))+p_num),n_mF(lat(p_b(n_b))-p_num,lon(p_b(n_b))+p_num)]);
        elseif lon(p_b(n_b))+p_num>dim(2)
            n_mF(idx(p_b(n_b)))=nanmean([n_mF(lat(p_b(n_b)),lon(p_b(n_b))-p_num),n_mF(lat(p_b(n_b))-p_num,lon(p_b(n_b))),n_mF(lat(p_b(n_b))-p_num,lon(p_b(n_b))-p_num)]);
        end
    end
    for n_l=1:length(p_l)
        if lat(p_l(n_l))-p_num>=1 && lat(p_l(n_l))+p_num<=dim(1) && lon(p_l(n_l))+p_num<=dim(2)
            n_mF(idx(p_l(n_l)))=nanmean([n_mF(lat(p_l(n_l))-p_num,lon(p_l(n_l))),n_mF(lat(p_l(n_l)),lon(p_l(n_l))+p_num),n_mF(lat(p_l(n_l))+p_num,lon(p_l(n_l))),n_mF(lat(p_l(n_l))-p_num,lon(p_l(n_l))+p_num),n_mF(lat(p_l(n_l))+p_num,lon(p_l(n_l))+p_num)]);
        elseif lat(p_l(n_l))-p_num<1
            n_mF(idx(p_l(n_l)))=nanmean([n_mF(lat(p_l(n_l)),lon(p_l(n_l))+p_num),n_mF(lat(p_l(n_l))+p_num,lon(p_l(n_l))),n_mF(lat(p_l(n_l))+p_num,lon(p_l(n_l))+p_num)]);
        elseif lat(p_l(n_l))+p_num>dim(1)
            n_mF(idx(p_l(n_l)))=nanmean([n_mF(lat(p_l(n_l))-p_num,lon(p_l(n_l))),n_mF(lat(p_l(n_l)),lon(p_l(n_l))+p_num),n_mF(lat(p_l(n_l))-p_num,lon(p_l(n_l))+p_num)]);
        elseif lon(p_l(n_l))+p_num>dim(2)
            n_mF(idx(p_l(n_l)))=nanmean([n_mF(lat(p_l(n_l))-p_num,lon(p_l(n_l))),n_mF(lat(p_l(n_l))+p_num,lon(p_l(n_l)))]);
        end
    end
    for n_r=1:length(p_r)
        if lat(p_r(n_r))-p_num>=1 && lon(p_r(n_r))-p_num>=1 && lat(p_r(n_r))+p_num<=dim(1)
            n_mF(idx(p_r(n_r)))=nanmean([n_mF(lat(p_r(n_r))-p_num,lon(p_r(n_r))),n_mF(lat(p_r(n_r)),lon(p_r(n_r))-p_num),n_mF(lat(p_r(n_r))+p_num,lon(p_r(n_r))),n_mF(lat(p_r(n_r))-p_num,lon(p_r(n_r))-p_num),n_mF(lat(p_r(n_r))+p_num,lon(p_r(n_r))-p_num)]);
        elseif lat(p_r(n_r))-p_num<1
            n_mF(idx(p_r(n_r)))=nanmean([n_mF(lat(p_r(n_r)),lon(p_r(n_r))-p_num),n_mF(lat(p_r(n_r))+p_num,lon(p_r(n_r))),n_mF(lat(p_r(n_r))+p_num,lon(p_r(n_r))-p_num)]);
        elseif lon(p_r(n_r))-p_num<1
            n_mF(idx(p_r(n_r)))=nanmean([n_mF(lat(p_r(n_r))-p_num,lon(p_r(n_r))),n_mF(lat(p_r(n_r))+p_num,lon(p_r(n_r)))]);
        elseif lat(p_r(n_r))+p_num>dim(1)
            n_mF(idx(p_r(n_r)))=nanmean([n_mF(lat(p_r(n_r))-p_num,lon(p_r(n_r))),n_mF(lat(p_r(n_r)),lon(p_r(n_r))-p_num),n_mF(lat(p_r(n_r))-p_num,lon(p_r(n_r))-p_num)]);
        end
    end
    % % change pixels with NaN for model but non-NaN for SMAP to non-NaN in model (others in center)
    % % n_o: number of pixels in center (i.e., other pixels)
    for n_o=1:length(p_o)
        if lat(p_o(n_o))-p_num>=1 && lon(p_o(n_o))-p_num>=1 && lat(p_o(n_o))+p_num<=dim(1) && lon(p_o(n_o))+p_num<=dim(2)
            n_mF(idx(p_o(n_o)))=nanmean([n_mF(lat(p_o(n_o)),lon(p_o(n_o))-p_num),n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))),n_mF(lat(p_o(n_o)),lon(p_o(n_o))+p_num),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))),n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))-p_num),n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))+p_num),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))-p_num),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))+p_num)]);
        elseif lat(p_o(n_o))-p_num<1
            n_mF(idx(p_o(n_o)))=nanmean([n_mF(lat(p_o(n_o)),lon(p_o(n_o))-p_num),n_mF(lat(p_o(n_o)),lon(p_o(n_o))+p_num),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))-p_num),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))+p_num)]);
        elseif lon(p_o(n_o))-p_num<1
            n_mF(idx(p_o(n_o)))=nanmean([n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))),n_mF(lat(p_o(n_o)),lon(p_o(n_o))+p_num),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))),n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))+p_num),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))+p_num)]);
        elseif lat(p_o(n_o))+p_num>dim(1)
            n_mF(idx(p_o(n_o)))=nanmean([n_mF(lat(p_o(n_o)),lon(p_o(n_o))-p_num),n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))),n_mF(lat(p_o(n_o)),lon(p_o(n_o))+p_num),n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))-p_num),n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))+p_num)]);
        elseif lon(p_o(n_o))+p_num>dim(2)
            n_mF(idx(p_o(n_o)))=nanmean([n_mF(lat(p_o(n_o)),lon(p_o(n_o))-p_num),n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))),n_mF(lat(p_o(n_o))-p_num,lon(p_o(n_o))-p_num),n_mF(lat(p_o(n_o))+p_num,lon(p_o(n_o))-p_num)]);
        end
    end
    % % Reculculate diff_num to check whether equals to 0
    logic_temp_modelf=single(~isnan(n_mF));
    diff_temp=logic_temp_modelf-logic_temp_obv;
    diff_num=length(find(diff_temp==-1));
    disp(['diff_num:',num2str(diff_num)])
    p_num=p_num+1;
    disp(['p_num:',num2str(p_num)])
end
end